import re
import config
import discord
import sqlite3

from discord.ext import commands
from discord import app_commands
from Functions.ColorConverter import hex_to_int

class Transfer(commands.Cog):
    def __init__(self, bot: commands.Bot):
        self.bot = bot
        self.database = sqlite3.connect("./Databases/profiles.sqlite")

    @commands.command(name="transfer")
    @commands.is_owner()
    async def _transfer(self, ctx: commands.Context):
        old_data = [['1', 'Hampter#5257', '1000005', '714309220350165004'], ['2', 'Jaypee#9666', '248', '818029049926516797'], ['3', '.JonTronWick#5607', '241', '485233076520353813'], ['4', 'jackaboy6889#5671', '173', '703430624161169488'], ['5', 'local f-15 strike fighter#6266', '166', '854099903809323018'], ['6', 'ArchDevil#0195', '149', '574626909040934912'], ['7', 'IrisRazor.#7109', '146', '812091912340766740'], ['8', 'Bored#1352', '143', '551756905307963392'], ['9', 'Whislash#1358', '140', '414430862755495936'], ['10', 'Resonance#6493', '137', '786581637802491975'], ['11', 'Venomousv10#1135', '137', '1107437463988863039'], ['12', 'WtrDrp#3255', '131', '749200644157603880'], ['13', 'Leo_com#2992', '110', '695338979012116513'], ['14', 'Clovis#5126', '99', '441435703453286403'], ['15', 'Dendii#3652', '96', '181509813514141696'], ['16', 'Venomousv10#1795', '94', '1018542658613944381'], ['17', 'RoughImpact#9601', '92', '728117065982148641'], ['18', 'HellCat Saturday#0467', '91', '242487045933498369'], ['19', 'Rhyonik#7961', '91', '628792505768345623'], ['20', 'Eclipse?#0518', '88', '726708216620384347'], ['21', 'taco#8622', '87', '1099510603846000721'], ['22', 'Wolfistic#3709', '86', '401585548206145538'], ['23', 'akira#6712', '83', '942786715834269716'], ['24', 'Viper 7915#7915', '81', '854650483293159424'], ['25', 'pandora#8331', '77', '674440586194976811'], ['26', 'Luck#0201', '76', '373100613552177162'], ['27', 'KeneksMe#2709', '73', '544090113299316748'], ['28', 'Developer X#0001', '73', '730108671228510269'], ['29', 'cps172#5031', '69', '763228854134243348'], ['30', 'The Mallard#8012', '66', '719213544511504475'], ['31', 'Tacticalboy#9387', '66', '1065081619058278430'], ['32', 'GIVE EVERYBODY ELSE A CHANCE#9523', '66', '388086561222295552'], ['33', 'father aidan#2359', '65', '783570774417342506'], ['34', 'rzn#7325', '65', '743695581192519720'], ['35', 'Aisyahdieeyah#0069', '64', '599818310896320538'], ['36', 'Dar.k#2193', '64', '691912821398700042'], ['37', 'CpnJack#3769', '61', '668607018847961119'], ['38', '2leaf2based#0833', '61', '949034879063052359'], ['39', 'prups#6665', '61', '558579534706900995'], ['40', 'Orange Face#5232', '57', '784290846630477835'], ['41', 'Grim#9253', '57', '467350570014081025'], ['42', 'ùñ£ùóãùñ∫ùñºùóà#7849', '57', '490811765748400130'], ['43', 'kish#6     403', '56', '847524530691506286'], ['44', 'MightyAngusMeal#6822', '56', '988011375546761217'], ['45', 'jayisfav#7123', '55', '1013119069232304198'], ['46', 'crxshy#1075', '55', '876173810003509299'], ['47', 'landonscharms#8270', '55', '1012485420744966207'], ['48', 'DrillMaster#2962', '55', '947508712745087046'], ['49', 'imc#5594', '55', '756327188676083743'], ['50', 'Breadslice#1770', '55', '456249460301889547'], ['51', 'just a toaster#3832', '55', '674796064427212821'], ['52', 'Ohio Man‚Ñ¢#5223', '55', '695282527887163502'], ['53', 'Dark_Zombie12#5198', '55', '730436125256056893'], ['54', 'OverHappy_#6506', '55', '770071524261756959'], ['55', 'LexieR#5081', '55', '1047699631083106354'], ['56', 'W√¥t_us#0543', '55', '799661800692908072'], ['57', 'Benny<3#1649', '55', '997570977565253642'], ['58', 'SockTrooper#4355', '55', '806905334538043434'], ['59', 'Dark_Timsh_08#6767', '55', '720224505967935498'], ['60', 'NŒõSŒõ#2692', '55', '313799772844720128'], ['61', 'TwistTornado#3812', '55', '598544024843976704'], ['62', 'GamerGGS239#2761', '53', '992517959216005210'], ['63', 'Decryption#7315', '51', '600620204317474816'], ['64', 'Bloodhound#9999', '51', '740208198983614484'], ['65', 'Striderpup#2644', '50', '766093027381870612'], ['66', 'Larguxerc#4989', '49', '282301111610900480'], ['67', 'blobtato#8795', '40', '734027792072704012'], ['68', 'Cummonium#1256', '39', '935125959701581827'], ['69', 'Ripper_Racer#2427', '37', '390131781463965697'], ['70', 'XDEagleXD#3872', '36', '643512478042554398'], ['71', 'ThermalTaco#9144', '35', '849303973119000596'], ['72', 'M.M.#7203', '35', '900218160316297226'], ['73', 'ExoticGamer#5970', '35', '1057626004769734726'], ['74', 'Rauxfirefox#0840', '34', '706680110463451227'], ['75', '_Cloud_#5831', '34', '329048494444642305'], ['76', 'Œöronos#0001', '32', '634999777464942602'], ['77', 'vengeance#1284', '30', '1098936155690504192'], ['78', 'Deadass retarded#8814', '29', '845781155596599297'], ['79', 'ZAZA#3378', '29', '898603195033587742'], ['80', 'Avhis#6380', '29', '528653423596404767'], ['81', 'RelentlessGoose#5925', '28', '870631927890198568'], ['82', 'Sunlight#3281', '27', '727873054524571729'], ['83', 'bryson90008#9951', '27', '747965311864799394'], ['84', 'Luka Atlas Ambrose#9676', '27', '531223192887492610'], ['85', 'N4TTY#9627', '26', '665916706291449859'], ['86', 'Shockwave#2621', '26', '817522508932317184'], ['87', 'ùì°ùì∏ùì´#6317', '26', '600788862486315102'], ['88', '20comer70correr#3804', '25', '518939985034870785'], ['89', 'saweeks#3334', '25', '327541255003439106'], ['90', 'zoila baby#9700', '25', '729281164740657182'], ['91', 'Alfreddy#1963', '24', '744122440367734785'], ['92', 'Buggz#7524', '24', '805163893835169792'], ['93', 'Chimken#2566', '23', '718617554939150397'], ['94', 'midnight#7717', '23', '868662362683629579'], ['95', 'Inspector Xero#5226', '23', '981084298889265162'], ['96', 'freak#0666', '22', '765481554226708490'], ['97', 'Stonks#2004', '22', '819516401177067530'], ['98', 'Warr1orAtWar#9841', '22', '465983505424449547'], ['99', 'Alluboyy#8199', '22', '683376775593721907'], ['100', 'Indianheroes#6673', '22', '802090491516157963'], ['101', 'pix#5489', '21', '932137937376784425'], ['102', 'LemonMuncher9#2774', '21', '962500614808567819'], ['103', 'Rat with a Warpstone#5036', '21', '358566992581623809'], ['104', 'Dr. Confusious#4051', '21', '478905568254361602'], ['105', 'chickenfricken#8763', '21', '486327176321564672'], ['106', 'NativesniperFTW#2383', '20', '295621491851001856'], ['107', 'Cupid#4704', '20', '889945410133712896'], ['108', 'lemon cactus#8158', '20', '892192332835860510'], ['109', 'Pr0b132atic#6738', '19', '990416394732597308'], ['110', 'Eclipse#9032', '19', '965802155359498260'], ['111', 'KevinKraai4#4552', '19', '317657434053279744'], ['112', 'Apollo12#0767', '19', '923660760771612682'], ['113', 'T√°ctical#0535', '18', '600845947395899393'], ['114', 'Pxykho#3217', '18', '1001425972349898843'], ['115', 'Wk#0981', '18', '532278949657575424'], ['116', 'AviaMitch#4991', '17', '826536048058040330'], ['117', 'JustASimpleGuy#6978', '17', '564441154955771904'], ['118', 'treyggj#8276', '16', '568209602328657920'], ['119', 'Your dad#7216', '16', '711273446247497888'], ['120', 'TYZ#9373', '15', '685417574464225280'], ['121', 'Ziovan24#6679', '15', '547692108488900608'], ['122', 'Tenzoth#7946', '15', '956091823762313256'], ['123', 'AlcoholicTendencies#9071', '14', '542725658099580940'], ['124', 'Krieg#5053', '14', '634717906873352192'], ['125', 'Fleshet#7663', '14', '798374620147351602'], ['126', 'tigerdragon#8780', '14', '964550797910224946'], ['127', 'Cloney boi#0258', '14', '592458286423343146'], ['128', 'HarveyBatman#0001', '14', '589461298484346890'], ['129', 'okfolksletsplay#4525', '14', '840841821566795778'], ['130', 'Mythdeath#2026', '13', '975408632814530622'], ['131', 'Echo2#0001', '13', '512763103570690049'], ['132', 'LastSamurai#1660', '13', '592692270533312512'], ['133', 'Han#4550', '13', '761583585244872735'], ['134', 'Plains#3994', '13', '761497294016086046'], ['135', 'Steal Eel Go Brrr#7882', '13', '833015316530331648'], ['136', 'Neutrino#5811', '13', '400054841298255872'], ['137', 'dylan_xd#6786', '12', '694296468412170321'], ['138', 'mario.#0100', '12', '511322322112872448'], ['139', 'hapy#1000', '12', '1066871766636560476'], ['140', 'Pandesal#5908', '12', '713253791205687317'], ['141', 'Spark#5700', '11', '722150343143719003'], ['142', 'Gamecool458#5128', '11', '906660396008607814'], ['143', 'squidsy#4687', '11', '532327820525830145'], ['144', 'Skarlet#5685', '11', '220935086453817345'], ['145', 'Darkmode_user#0151', '11', '799098254901510165'], ['146', 'cooplo_78#0700', '10', '913515008963522631'], ['147', 'the vengeful dream walking lich#1920', '10', '764608066351529996'], ['148', 'blessssssssssssssssssss#1079', '10', '497122776457412628'], ['149', 'F2X#4976', '10', '846067805216309258'], ['150', 'elijahjosiah81#9845', '10', '338400804434345984'], ['151', 'Antiterrorist Kettle#9248', '10', '658300697267142676'], ['152', 'Disiapolthic#1317', '10', '764435884295979011'], ['153', 'iliketoswim#9681', '10', '661837130519281664'], ['154', 'poop1#4042', '10', '801081940274708480'], ['155', 'Redzevil#6369', '9', '969395131117617183'], ['156', 'IRS Agent#8879', '9', '954471288292925510'], ['157', 'FuzzyKrie#9711', '9', '425499400060796938'], ['158', 'arodful#8920', '9', '794560246050979901'], ['159', 'Lufa#8703', '9', '800927842270838835'], ['160', 'Qauzker#5864', '9', '822247930122993664'], ['161', 'Coco Bunny#0095', '9', '352316731223572482'], ['162', 'mooptoast#4762', '9', '801530717464166440'], ['163', 'RealEjwalker09#1313', '9', '1036856526352154636'], ['164', 'Potato_Legend#8833', '9', '802165100366528574'], ['165', 'Kerrigan#2785', '8', '270253373704372225'], ['166', 'Rawr Doggy#9439', '8', '885542131425493073'], ['167', 'DaRefff#8193', '8', '150304511909560321'], ['168', 'fish.#4253', '8', '823925785840582667'], ['169', 'BuilderB08#1350', '8', '766320482017607711'], ['170', 'GreekWithNoMoney#9100', '8', '807569202814517269'], ['171', 'just_a_doggo#5636', '8', '829513318489129013'], ['172', '[EST] Tonk#9307', '8', '725109430420635769'], ['173', 'Jack4822K#6321', '8', '825615167219433493'], ['174', 'Doku#1680', '8', '546926996039401483'], ['175', 'Cephalon#4565', '8', '1050747263833612339'], ['176', 'bacon_sh0rk#6669', '8', '559764906879090693'], ['177', 'Minhtrihoang2#9487', '8', '825000608507101194'], ['178', 'CommandantVasilis#6585', '8', '585602576477585429'], ['179', 'Galvo288#2573', '7', '1047211507370442784'], ['180', 'Magic#4569', '7', '530709931096145940'], ['181', 'MrKillSteal#7197', '7', '750168794001047593'], ['182', 'BoeingLeo87#9478', '7', '794476259307945995'], ['183', 'ehtan#7691', '7', '758218254660665374'], ['184', 'Sloth#4605', '7', '891391517002981417'], ['185', 'TheAverageAsian#3734', '7', '691084231178322023'], ['186', 'Rim Protector#8186', '7', '925469962993295420'], ['187', 'X3double#1144', '7', '761403925496594453'], ['188', 'LD#8236', '6', '792509315143041055'], ['189', 'The Talking Tree#1158', '6', '784940031634440203'], ['190', 'Flaze#7986', '6', '583014774154199070'], ['191', 'PlagueHasAquiredSnickers#0113', '6', '448993194487709699'], ['192', 'DeIta#2991', '5', '906282563826491402'], ['193', 'lolimadodo#5422', '5', '792534595916529694'], ['194', 'Cursed Soul#2502', '5', '532743207197474816'], ['195', 'Simp smol pp#5401', '5', '926668782947160064'], ['196', 'WhiteBoyLance#3602', '5', '795269809146691594'], ['197', 'ShnipShnap#0046', '5', '787312784676225034'], ['198', 'GhostOfMandalore#0338', '5', '916723128628023306'], ['199', 'LeonDeadly#4615', '5', '980486049518194698'], ['200', 'GioJanvee#0321', '5', '253172811760271360'], ['201', 'Bigoneg8016"Outcast"#0048', '5', '457292194873606164'], ['202', 'PhoenixChan#6181', '5', '448000926406672384'], ['203', 'Doom#4367', '5', '872126053286559754'], ['204', 'naginxgi#2005', '4', '583582060107661331'], ['205', 'Cryseon#2761', '4', '656873822271832066'], ['206', 'Dis-#2301', '4', '780708245442527262'], ['207', 'Willy The Wolfy#6756', '4', '474255795291422722'], ['208', 'TAMOHAWK#7384', '4', '372302301261594636'], ['209', 'grim#7394', '4', '972745204786429972'], ['210', 'Pozaaa#2939', '4', '608963933872586773'], ['211', 'shaw#1309', '4', '363813514785193985'], ['212', 'tacoguy#2539', '4', '793161003810029598'], ['213', 'western#8008', '4', '532333220318937088'], ['214', 'Reyes#8538', '4', '692341423848161390'], ['215', 'BlameTC#0131', '4', '589510920082948098'], ['216', 'thebananahunter#0000', '4', '435539056185573386'], ['217', 'based.mp4#2415', '4', '771718334965219339'], ['218', 'Random Aussie#2465', '3', '896556116769640448'], ['219', 'deleted user#6421', '3', '693988654414299228'], ['220', 'Peculiarxty#9353', '3', '993603224235942030'], ['221', 'Raspyvoice#7978', '3', '563536788006764544'], ['222', 'Special Ops#0606', '3', '632058583483285524'], ['223', 'LoganA672#1520', '3', '569637403699052701'], ['224', 'Meme_py#0001', '3', '586259067396161566'], ['225', 'Mack-pog#3559', '3', '821005171122765855'], ['226', 'Sp1ky#9418', '3', '548671939254681620'], ['227', 'that weird potato person#1904', '3', '1013188864489291898'], ['228', 'Tonk Bonk#4081', '3', '469123587056336898'], ['229', 'vital_vzlli#8445', '3', '808490615767564318'], ['230', 'Roomba#0924', '3', '733739114410672189'], ['231', 'Balllicker#8114', '3', '1054602992705347615'], ['232', 'pickle#5452', '3', '512277665730920448'], ['233', 'Mistictitan#0663', '3', '773335620549738539'], ['234', 'whipgear#0035', '3', '498245534210064394'], ['235', 'BringerOfDeath#1818', '2', '1025958347985391656'], ['236', '–Ω–∏–∫—Ç–æ#4115', '2', '867373724680192061'], ['237', 'ItsGery#2389', '2', '673642324399489039'], ['238', 'Rhythm Game Enthusiast#6482', '2', '798720452863197206'], ['239', 'Icerfly#6401', '2', '826484769101053962'], ['240', 'zNC#2036', '2', '492745200167551021'], ['241', '.Ethan#0520', '2', '598696135539949612'], ['242', '77.#7777', '2', '1077795793299308635'], ['243', 'Sezptic#0343', '2', '681255910760251435'], ['244', '5star.cam#2615', '2', '751171841959264338'], ['245', 'K ig#7002', '2', '538934405226430494'], ['246', 'bravo3#5880', '2', '905874790177472585'], ['247', 'Mrfoxer#4663', '2', '368653205569011714'], ['248', 'Paras0G#3576', '2', '279463908400693259'], ['249', 'lego man#3831', '2', '700711873737261156'], ['250', 'Xan#9549', '2', '877456743045685248'], ['251', 'RizekSKasi#0174', '2', '1063553964710305822'], ['252', 'TOM#0680', '2', '873413477006475275'], ['253', 'Astroboi#6419', '2', '873280525702406204'], ['254', 'G√òLŒ£M#1666', '2', '324604811032920075'], ['255', 'GODNico13#9224', '2', '702251811750543451'], ['256', 'UM.Dexire#0001', '2', '421295754448207873'], ['257', 'anxitic#9313', '1', '901587541587812372'], ['258', 'BRAVO#4908', '1', '694640501957197934'], ['259', '„Åä¬ª–¢–æ–≤–∞—Ä–∏—â#1992', '1', '691640811091394573'], ['260', 'Dark_Dragon1617#6335', '1', '782583822755037207'], ['261', 'A.Real.Catto#8445', '1', '941844464283045930'], ['262', 'Silence#4958', '1', '769208305327276063'], ['263', 'ZeBagelmensch#9701', '1', '363495821104381953'], ['264', 'Seven#5861', '1', '809848855306174486']]
        for entry in old_data:
            print("Getting Data")
            user = ctx.guild.get_member(int(entry[3]))
            points = int(entry[2])
            if user:
                print("Found User")
                RANKS = config.RANKS
                if user.nick and "TFH" not in user.nick and "HIT" not in user.nick:
                    print("User has nickname")
                    pattern = r'\[(\w+)-(\w+)\] (\w+)'

                    match = re.match(pattern, user.nick)
                    if match:
                        print("Getting Data 1")
                        paygrade = match.group(1)
                        squad_code = match.group(2)
                        callsign = match.group(3)
                        print(paygrade, squad_code, callsign)
                        print(RANKS[paygrade]["name"])
                        
                        # current_rank_role = ctx.guild.get_role(RANKS[paygrade]['id'])
                        # next_rank_role = ctx.guild.get_role(RANKS[RANK_LIST[next_rank_position]]['id'])
                            
                        self.database.execute(
                            '''
                                INSERT INTO UserProfiles VALUES (?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (user_id) DO UPDATE SET points = points + ? WHERE user_id = ?
                            ''',
                            (
                                user.id,
                                'Bio and embed color isn\'t configurable yet.',
                                hex_to_int(hex_code='FFFFFF'),
                                callsign,
                                RANKS[paygrade]["name"],
                                paygrade,
                                squad_code,
                                points,
                                points,
                                user.id,
                            )
                        ).connection.commit()
                        print("Updated {}'s data".format(user.nick))
        
        print("\nDone Transferring!")


async def setup(bot: commands.Bot):
    await bot.add_cog(Transfer(bot))